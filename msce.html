<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Smart Student - Past Papers</title>
  <meta name="description" content="Access past exam papers easily on Smart Student."/>
  <meta name="keywords" content="MSCE, JCE, Past Papers, Malawi, Exams, Education"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }

    body {
      background: #f7f9fb;
      min-height: 100vh;
      overflow-x: hidden;
    }

    .container {
      padding: 30px 5%;
      max-width: 1000px;
      margin: auto;
    }

    .paper-item {
      background: white;
      border-radius: 8px;
      margin-bottom: 10px;
      padding: 15px;
      cursor: pointer;
      transition: background 0.3s ease;
      border: 1px solid #ddd;
    }

    .paper-item:hover {
      background: #eef3ff;
    }

    .paper-title {
      font-weight: 600;
      font-size: 1rem;
      color: #333;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .skeleton-item {
      height: 60px;
      border-radius: 8px;
      margin-bottom: 10px;
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }

    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }

    .pagination {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 30px;
    }

    .pagination button {
      padding: 8px 14px;
      font-size: 0.95rem;
      font-weight: 600;
      border: none;
      border-radius: 12px;
      background: linear-gradient(to right, #4a6bff, #a855f7);
      color: white;
      cursor: pointer;
      transition: transform 0.2s ease, background 0.3s ease;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
    }

    .pagination button:hover {
      transform: scale(1.05);
    }

    .pagination button.active {
      background: linear-gradient(to right, #a855f7, #4a6bff);
      box-shadow: 0 3px 8px rgba(74, 107, 255, 0.3);
    }

    .pagination button:disabled {
      background: #ccc;
      color: #555;
      cursor: default;
      box-shadow: none;
    }

    /* Scroll to Top Button */
    #scrollTopBtn {
      position: fixed;
      bottom: 30px;
      right: 30px;
      z-index: 999;
      font-size: 1.5rem;
      background: linear-gradient(to right, #4a6bff, #a855f7);
      color: white;
      border: none;
      border-radius: 50%;
      padding: 15px 18px;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(74, 107, 255, 0.3);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease, transform 0.3s ease;
    }

    #scrollTopBtn.show {
      opacity: 1;
      pointer-events: auto;
    }

    #scrollTopBtn:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 24px rgba(74, 107, 255, 0.4);
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="papers-grid"></div>
    <div class="pagination" id="pagination"></div>
  </div>

  <!--<button id="scrollTopBtn"><i class="fas fa-arrow-up"></i></button>-->

  <script>
    const papersGrid = document.querySelector('.papers-grid');
    const pagination = document.getElementById('pagination');
    const scrollBtn = document.getElementById('scrollTopBtn');

    let allFiles = [];
    let currentPage = 1;
    const itemsPerPage = 20;

    function showDummyLoading(count = 10) {
      papersGrid.innerHTML = '';
      for (let i = 0; i < count; i++) {
        const skeleton = document.createElement('div');
        skeleton.className = 'skeleton-item';
        papersGrid.appendChild(skeleton);
      }
    }

    showDummyLoading();

    fetch("https://script.google.com/macros/s/AKfycbxgLeuQXBRxEi6RPQjYKNozKcoo0SRs5-GHkPAZ2K_mfKtGLEYb7qKS5A8u06LElTZ6/exec")
      .then(res => res.json())
      .then(files => {
        allFiles = files;
        renderFiles(files);
      })
      .catch(() => {
        papersGrid.innerHTML = '<p style="color:red;text-align:center;">Failed to load papers. Please try again later.</p>';
      });

    function renderFiles(files) {
      const startIndex = (currentPage - 1) * itemsPerPage;
      const paginatedFiles = files.slice(startIndex, startIndex + itemsPerPage);

      papersGrid.innerHTML = '';
      window.scrollTo({ top: 0, behavior: 'smooth' });

      if (paginatedFiles.length === 0) {
        papersGrid.innerHTML = '<p style="text-align:center; color:#888;">No papers found.</p>';
        pagination.innerHTML = '';
        return;
      }

      paginatedFiles.forEach(file => {
        const title = file.title.replace('.pdf', '');
        const fileIdMatch = file.url.match(/\/d\/(.*?)\//);
        const fileId = fileIdMatch ? fileIdMatch[1] : '';

        const wrapper = document.createElement('div');
        wrapper.className = 'paper-item';
        wrapper.innerHTML = `<div class="paper-title">${title}</div>`;
        wrapper.onclick = () => window.open(`viewer.html?fileId=${fileId}`, '_blank');
        papersGrid.appendChild(wrapper);
      });

      renderPaginationControls(files.length);
    }

    function renderPaginationControls(totalItems) {
      const totalPages = Math.ceil(totalItems / itemsPerPage);
      pagination.innerHTML = '';

      if (totalPages <= 1) return;

      const createButton = (label, page, disabled = false, active = false) => {
        const btn = document.createElement('button');
        btn.textContent = label;
        if (active) btn.classList.add('active');
        if (disabled) btn.disabled = true;
        btn.addEventListener('click', () => {
          currentPage = page;
          renderFiles(allFiles);
        });
        return btn;
      };

      pagination.appendChild(createButton('← Prev', currentPage - 1, currentPage === 1));

      for (let i = 1; i <= totalPages; i++) {
        pagination.appendChild(createButton(i, i, false, i === currentPage));
      }

      pagination.appendChild(createButton('Next →', currentPage + 1, currentPage === totalPages));
    }

    window.addEventListener('scroll', () => {
      if (window.scrollY > 200) scrollBtn.classList.add('show');
      else scrollBtn.classList.remove('show');
    });

    scrollBtn.addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  </script>
</body>
</html>